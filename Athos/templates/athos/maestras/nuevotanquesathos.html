{% extends 'base/baseathos.html' %}
{% block contenido%}

<section class="contenedor" id="section-usuarios">
    <div id="registration-form">
        <div class='fieldset'>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header"><strong>Registro</strong><small>TANQUES ATHOS</small></div>
                    <div class="card-body card-block">
                        <form id="frmajax"  method="post" data-validate="parsley">
                            {% csrf_token %}

                            {% if form.errors %}
                                {% for field in form %}

                                    {% for error in field.errors %}
                                    <div class="alert alert-danger">
                                        <strong>{{ field.label|escape }}:</strong>
                                        <strong>{{ error|escape }}</strong>
                                    </div>
                                    {% endfor %}
                                {% endfor %}
                                {% for error in form.non_field_errors %}
                                    <div class="alert alert-danger">
                                        <strong>{{ error|escape }}</strong>
                                    </div>
                                {% endfor %}
                            {% endif %}

                            <div class='form-group'>
                                {{form.anexo_zona.label}}
                                {{form.anexo_zona}}
                            </div>
                            <div class='form-group'>
                                {{form.anexo_fundo.label}}
                                {{form.anexo_fundo}}
                            </div>
                            <div class='form-group'>
                                {{form.numero_tanque.label}}
                                {{form.numero_tanque}}
                            </div>
                            <div class='form-group'>
                                {{form.capacidad.label}}
                                {{form.capacidad}}
                            </div>
                            <div class='form-group d-none'>
                                {{form.fundo_tanque.label}}
                                {{form.fundo_tanque}}
                            </div>                            

                            <input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{%block script%}

<script type="text/javascript">

    function request_zona (fundoId) {
        var urldata="/ajax/load-fundos/" + fundoId;

        $.ajax({                       
            url: urldata,                    
            data: {},
            success: function (data) {
                var option_html = `<option value="0" >---------</option>`;
                for (var i = 0; i < data.length; i++) {     


                    option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;

                } 
                $("#id_anexo_fundo").html(option_html);
                console.log(option_html);
            },
            error: function(result) {
                console.log(result);
            }

        });

    }

    $("#id_anexo_zona").change(function () { 

        var fundoId = $(this).val();

        request_zona(fundoId)
    });

    $("#id_anexo_fundo").change(function () {
        $("#id_fundo_tanque").val($("#id_anexo_fundo").val() + " - " + $("#id_numero_tanque").val());
    });

    $("#id_numero_tanque").change(function () {
        $("#id_fundo_tanque").val($("#id_anexo_fundo").val() + " - " + $("#id_numero_tanque").val());
    });    

</script>

{% endblock %}
