{% extends 'base/baseathos.html' %}
{% block contenido%}



<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
		<div class="col-lg-6">
					<div class="card">
					<div class="card-header"><strong>Registro</strong><small> GUIA HO-NP2021</small></div>
					<div class="card-body card-block">
			<a href="javascript: history.go(-1)" >
				<button type="button" class="btn btn-secondary">Atrás</button>
			</a>			
			<form id="frmajax"  method="post" data-validate="parsley">
				{% csrf_token %}
				
				{% if form.errors %}
				    {% for field in form %}

				        {% for error in field.errors %}
				            <div class="alert alert-danger">
				                <strong>{{ field.label|escape }}:</strong>
				                <strong>{{ error|escape }}</strong>
				            </div>
				        {% endfor %}
				    {% endfor %}
				    {% for error in form.non_field_errors %}
				        <div class="alert alert-danger">
				            <strong>{{ error|escape }}</strong>
				        </div>
				    {% endfor %}
				{% endif %}
				<div class='form-group'>
					{{form.NroGuia.label}}
					{{form.NroGuia}}
				</div>
				<div class='form-group'>
					{{form.anexo_sociedad.label}}
					{{form.anexo_sociedad}}
				</div>
				<div class='form-group'>
					{{form.anexo_zona.label}}
					{{form.anexo_zona}}
				</div>
				
			
				<div class='form-group'>
					{{form.anexo_almacen.label}}
					{{form.anexo_almacen}}
				</div>
				<div class='form-group'>
					{{form.anexo_vehiculo.label}}
					{{form.anexo_vehiculo}}
				</div>
				<div class='form-group'>
					{{form.anexo_chofer.label}}
					{{form.anexo_chofer}}
				</div>
				
				<div class='form-group'>
					{{form.ubic_partida.label}}
					{{form.ubic_partida}}
				</div>
				<div class='form-group'>
					{{form.ubic_llegada.label}}
					{{form.ubic_llegada}}
				</div>
				  <div class='form-group'>
          {{form.anexo_fundo.label}}
          {{form.anexo_fundo}}
        </div>
         <div class='form-group'>
          {{form.nroprecinto.label}}
          {{form.nroprecinto}}
        </div>
				<div class='form-group' id='ocultarev'>
          
					{{form.fecha_transporte.label}}
					{{form.fecha_transporte}}
				</div>
				<div class='form-group'>
					{{form.longitud.label}}
					{{form.longitud}}
				</div>
				<div class='form-group'>
					{{form.latitud.label}}
					{{form.latitud}}
				</div>
				<input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
			</form>
	</div>
	</div>
</div>
</div>
</div>
</section>
{% endblock %}

{%block script%}
 
<script type="text/javascript">
      $('#id_anexo_zona').select2();
      $('#id_anexo_centro').select2();
      $('#id_anexo_almacen').select2();
      $('#id_anexo_chofer').select2();
		$('#id_anexo_vehiculo').select2();
      $('#id_ubic_partida').select2();
      $('#id_ubic_llegada').select2();

     function request_almacen (fundoId) {
		var urldata="/ajax/load-almacenes/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].almacen}-${data[i].desc_almacen}</option>`;
        		
        } 
        $("#id_anexo_almacen").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
      
       $("#id_anexo_zona").change(function () { 
       		console.log(fundoId);
      var fundoId = $(this).val();
      	
      request_almacen(fundoId)
    });


     function request_vehiculos (fundoId) {
		var urldata="/ajax/load-vehiculos/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].placas}</option>`;
        		
        } 
        $("#id_anexo_vehiculo").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
      
    $("#id_anexo_zona").change(function () { 
       		console.log(fundoId);
      var fundoId = $(this).val();
      	
      request_vehiculos(fundoId)
    });

    function request_chofer (fundoId) {
		var urldata="/ajax/load-chofer/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].ApellidoPat}- ${data[i].ApellidoMat}- ${data[i].Nombres}</option>`;
        		
        } 
        $("#id_anexo_chofer").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
      
    $("#id_anexo_zona").change(function () { 
       		console.log(fundoId);
      var fundoId = $(this).val();
      	
      request_chofer(fundoId)
    });

     function request_ubicacion (fundoId) {
		var urldata="/ajax/load-ubicacion/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].Lugar}</option>`;
        		
        } 
        $("#id_ubic_partida").html(option_html);
        	console.log(option_html);
        },


        error: function(result) {
            console.log(result);
        }
         

      });

	} 
      
    $("#id_anexo_zona").change(function () { 
       		console.log(fundoId);
      var fundoId = $(this).val();
      	
      request_ubicacion(fundoId)
       });
   function request_ubicacion1 (fundoId) {
		var urldata="/ajax/load-ubicacion/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].Lugar}</option>`;
        		
        } 
        $("#id_ubic_llegada").html(option_html);
        	console.log(option_html);
        },


        error: function(result) {
            console.log(result);
        }
         

      });

	} 
      
    $("#id_anexo_zona").change(function () { 
       		console.log(fundoId);
      var fundoId = $(this).val();
      	
      request_ubicacion1(fundoId) 

 });


   function request_zona (fundoId) {
    var urldata="/ajax/load-fundos/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) {   
        
            
              option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;
            
        } 
        $("#id_anexo_fundo").html(option_html);
          console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

  } 
      
       $("#id_anexo_zona").change(function () { 

      var fundoId = $(this).val();
        
      request_zona(fundoId)
    });

      
  </script>




 <script> 

  $(function () {  
   $("#datepicker").datetimepicker({  
       format: 'd/m/Y',  
       timepicker:false  
   });  
  });  
 </script>
 <script>  
     $(document).ready(function () {  
           jQuery.datetimepicker.setLocale('es');  
     });  
   </script> 

   
    <script>  
     $(document).ready(function () {  
		n =  new Date();
		y = n.getFullYear();
		//Mes
		m = n.getMonth() + 1;
		//Día
		d = n.getDate();

//Lo ordenas a gusto.

	if(m<10)
    {
      if(d<10)
      {
        $("#datepicker").val("0"+ d + "/" +"0" +m + "/" +y);
      }
      else
      {
        $("#datepicker").val( d + "/" +"0" +m + "/" +y);  
      }
    }
    else
    {
       if(d<10)
      {
        $("#datepicker").val("0"+ d + "/" + m + "/" +y);
      }
      else
      {
        $("#datepicker").val( d + "/" + m + "/" +y);  
      }
    }
		

        if ("geolocation" in navigator)
          { //check geolocation available 
    //try to get user current location using getCurrentPosition() method
   			 navigator.geolocation.getCurrentPosition(function(position){ 
           	 console.log("Found your location nLat : "+position.coords.latitude+" nLang :"+ position.coords.longitude);
           	 lat=position.coords.latitude;
           	 lon=position.coords.longitude;

           	 nlat=Math.round((lat)*10000000)/10000000;
           	 nlon=Math.round((lon)*10000000)/10000000;
           	 $("#id_longitud").val(nlon);
			 $("#id_latitud").val(nlat);
       		 });

		  }
		else
		{
   			 console.log("Browser doesn't support geolocation!");
		}

     });  
   </script>


<script>
	$(document).ready(function() {

	/*$('#id_linea').change(function(){
		document.getElementById("id_Codigoqr").focus();
	});
	*/

   
	 
		 document.getElementById("id_anexo_sociedad").value=1;
		
   
    
  
   });

</script>

{% endblock %}