{% extends 'base/baseathos.html' %}
{% load staticfiles %}
{% block contenido%}

<style type="text/css">
	.form-group select{
		width: auto;
		cursor: pointer;
		height: 30px;
		font-size: 10px;
		font-family: 'Quicksand', sans-serif;
		border: 2px solid rgba(0, 0, 0, 0.2);
		border-radius: 5px;
	}

	#id_anexo_labor{
		width: 150px !important;
		cursor: pointer;
		height: 45px;
		font-family: 'Quicksand', sans-serif;
	}

	.select2-selection__rendered {
		font-family: 'Quicksand', sans-serif;
		font-size: 10px;
	}

	.select2-results__options{
		font-size: 10px !important;
	}

	.valores{
		width: 50px;
		height: 30px;
		font-size: 10px;
		font-family: 'Quicksand', sans-serif;
		border: 2px solid rgba(0, 0, 0, 0.2);
		border-radius: 5px;
	}

</style>

<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
			<div class="col-lg-24">
				<div class="card">
					<div class="card-header"><strong>Registro</strong><small> DETALLE PROYECCION SEMANAL</small></div>
					<div class="card-body card-block">
						<form id="frmajax" class="formulario"  method="post" data-validate="parsley">
							{% csrf_token %}

							<table class="table-responsive table table-bordered">
								<thead class="thead-dark">
									<tr>
										<th scope="col" class="text-center"><div style="margin-bottom: 10px;">PEP</div></th>
										<th scope="col" class="text-center"><div style="margin-bottom: 10px;">PRODUCTO</div></th>
										<th scope="col" class="text-center"><div>SEMANA 1</div></th>
										<th scope="col" class="text-center"><div>SEMANA 2</div></th>
										<th scope="col" class="text-center"><div>SEMANA 3</div></th>
										<th scope="col" class="text-center"><div>SEMANA 4</div></th>
										<th scope="col" class="text-center"><div style="margin-bottom: 10px;">ACCIÃ“N</div></th>
									</tr>
								</thead>
								<tbody id="cuerpo-data">
									<tr>
										<td><div class='form-group'>
											{{form.anexo_pep}}
										</div></td>
										<td><div class='form-group'>
											{{form.anexo_ley}}
										</div></td>
										<td><div class='form-group'>
											{{form.semana_1}}
										</div></td>
										<td><div class='form-group'>
											{{form.semana_2}}
										</div></td>
										<td><div class='form-group'>
											{{form.semana_3}}
										</div></td>
										<td><div class='form-group'>
											{{form.semana_4}}
										</div></td>
										<td><div class='form-group'>
											<a href="#" onclick="agregar();"><img style="width: 35px; height: 35px" src="{% static 'images/add_button.png' %}" title="add"></a>
										</div></td>
									</tr>
								</tbody>
							</table>

							<div class="text-center">
								<button onclick="send();"  value="Registrar" id="registrar" class="btn btn-success w-25">REGISTRAR</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock %}

{% block script %}
<script type="text/javascript">

	$('#id_anexo_labor').select2();
	$('#id_anexo_labor').select2({
		theme: 'classic',
		width: 'resolve',
		font: 'resolve'
	});

	function agregar(){

		var campo = `
		<tr class="formulario">
		<td><div class='form-group'>
		{{form.anexo_pep}}
		</div></td>
		<td><div class='form-group'>
		{{form.anexo_ley}}
		</div></td>
		<td><div class='form-group'>
		{{form.semana_1}}
		</div></td>
		<td><div class='form-group'>
		{{form.semana_2}}
		</div></td>
		<td><div class='form-group'>
		{{form.semana_3}}
		</div></td>
		<td><div class='form-group'>
		{{form.semana_4}}
		</div></td>
		<td><div class='form-group'>
		<a href="#" onclick="agregar();"><img style="width: 35px; height: 35px" src="{% static 'images/add_button.png' %}" title="add"></a>
		</div></td>
		</tr>`;

		$("#cuerpo-data").append(campo);
	}
</script>

<script type="text/javascript">
	function send(){

		document.querySelectorAll(".formulario").forEach(element=>{
			console.log(element);

			data={
				'anexo_save':'true',
				'anexo_pep':element.querySelector('[id=id_anexo_pep]').value,
				'anexo_ley':element.querySelector('[id=id_anexo_ley]').value,
				'semana_1':element.querySelector('[id=id_semana_1]').value,
				'semana_2':element.querySelector('[id=id_semana_2]').value,
				'semana_3':element.querySelector('[id=id_semana_3]').value,
				'semana_4':element.querySelector('[id=id_semana_4]').value,
			}

			$.ajax({
				type: "GET",
				url: "{% url 'creardetalleproyeccionsemanalriego' 89 subid %}",
				data: data,
				dataType: "json",
				success: function(data) {
					console.log(data);
					window.location.replace("{% url 'detalleproyeccionsemanalriego' 89 subid %}");
				},
				error: function() {
					alert('error handling here');
				}
			});

		});
	}
</script>

{%endblock%}