{% extends 'base/baseathos.html' %}
{% block contenido%}



<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
		<div class="col-lg-6">
					<div class="card">
					<div class="card-header"><strong>Registro</strong><small> GARITA ACOPIO</small></div>
					<div class="card-body card-block">
						<a href="javascript: history.go(-1)" >
				<button type="button" class="btn btn-secondary">Atr√°s</button>
			</a>
			<form id="frmajax"  method="post" data-validate="parsley">
				{% csrf_token %}
					<div class='form-group'>
					{{form.zona.label}}
					{{form.zona}}
				</div>
				
				<div class='form-group'>
					{{form.ubicacion.label}}
					{{form.ubicacion}}
				</div>
				<div class='form-group'>
					{{form.ruta.label}}
					{{form.ruta}}
				</div>
				<div class='form-group'>
					{{form.chofer_ref.label}}
					{{form.chofer_ref}}
				</div>


				<div class='form-group'>
					{{form.qrplaca.label}}
					{{form.qrplaca}}
				</div>
				
				<div class='form-group'>
					{{form.qrcampo.label}}
					{{form.qrcampo}}
				</div>
				
				
				<div class='form-group'>
					{{form.kilometraje.label}}
					{{form.kilometraje}}
				</div>
				<div class='form-group'>
					{{form.cantpasajeros.label}}
					{{form.cantpasajeros}}
				</div>
				<div class='form-group'>
					{{form.observacion.label}}
					{{form.observacion}}
				</div>
				<div class='form-group' id="longitud">
					{{form.longitud.label}}
					{{form.longitud}}
				</div>
				
				<div class='form-group' id="latitud">
					{{form.latitud.label}}
					{{form.latitud}}
				</div>
				
				<input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
			</form>
	</div>
	</div>
</div>
</div>
</div>
</section>
{% endblock %}
{% block script %}
<script type="text/javascript">
	 $('#id_zona').select2();
     $('#id_ubicacion').select2();
      
     
   
        $('#id_ruta').select2();
      
     // $("#id_anexo_cultivo").val(2).trigger('change');
      //$("#id_anexo_eje").val(2).trigger('change');
     
      
 function request_zona (fundoId) {
		var urldata="/ajax/load-fundos/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;
        		
        } 
        $("#id_ubicacion").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
   
 function request_ruta (ubicacionId) {
		var urldata="/ajax/load-rutas/" + ubicacionId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].rutas}</option>`;
        		
        } 
        $("#id_ruta").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 





       $("#id_zona").change(function () { 

      var fundoId = $(this).val();
      	
      request_zona(fundoId)
    });

  $("#id_ubicacion").change(function () { 

      var ubicacionId = $(this).val();
      	
      request_ruta(ubicacionId)
    });




  </script>








   <script>  
     $(document).ready(function () {  
	
          if ("geolocation" in navigator)
          { //check geolocation available 
    //try to get user current location using getCurrentPosition() method
   			 navigator.geolocation.getCurrentPosition(function(position){ 
           	 console.log("Found your location nLat : "+position.coords.latitude+" nLang :"+ position.coords.longitude);
           	 lat=position.coords.latitude;
           	 lon=position.coords.longitude;

           	 nlat=Math.round((lat)*1000000)/1000000;
           	 nlon=Math.round((lon)*1000000)/1000000;
           	 $("#id_longitud").val(nlon);
			 $("#id_latitud").val(nlat);
       		 });

		  }
		else
		{
   			 console.log("Browser doesn't support geolocation!");
		}
		

     });  
   </script>

{%endblock%}

