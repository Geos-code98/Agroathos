{% extends 'base/baseathos.html' %}
{% block contenido%}

<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
		<div class="col-lg-6">
					<div class="card">
					<div class="card-header"><strong>Registro</strong><small> EV. CALIDAD MUESTREO COSECHA HG</small></div>
					<div class="card-body card-block">
			<form id="frmajax"  method="post" data-validate="parsley">
				{% csrf_token %}
				{% if form.errors %}
            {% for field in form %}

                {% for error in field.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ field.label|escape }}:</strong>
                        <strong>{{ error|escape }}</strong>
                    </div>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <div class="alert alert-danger">
                    <strong>{{ error|escape }}</strong>
                </div>
            {% endfor %}
        {% endif %}
        
        <div class='form-group'>
            {{form.dni.label}}
            {{form.dni}}
        </div>

        <div class='form-group'>
          {{form.anexo_auxiliares.label}}
          {{form.anexo_auxiliares}}
        </div>

        <div class='form-group'>
            {{form.valvula.label}}
            {{form.valvula}}
        </div>
        
        <div class='form-group'>
          {{form.anexo_variedad.label}}
          {{form.anexo_variedad}}
        </div>
        
        <div class='form-group'>
          {{form.reingreso.label}}
          {{form.reingreso}}
        </div>

        <div class='form-group'>
          {{form.anexo_caseta.label}}
          {{form.anexo_caseta}}
        </div>
       
        <div class='form-group'>
          {{form.anexo_tipo.label}}
          {{form.anexo_tipo}}
        </div>

         <div class='form-group' id="ev1">
          {{form.nfrutas.label}}
          {{form.nfrutas}}
        </div>

        <div class='form-group'id="ev2">
          {{form.densidad.label}}
          {{form.densidad}}
        </div>

		<div class='form-group' id="ev3">
			{{form.inmaduro.label}}
			{{form.inmaduro}}
		</div>
       
        <div class='form-group' id="ev4">
          {{form.sobremaduro.label}}
          {{form.sobremaduro}}
        </div>

        <div class='form-group' id="ev5">
          {{form.mal_corte.label}}
          {{form.mal_corte}}
        </div>
		<div class='form-group' id="ev6">
          {{form.danio_mecanico.label}}
          {{form.danio_mecanico}}
        </div>
      
		<div class='form-group' id="ev7">
          {{form.latex.label}}
          {{form.latex}}
        </div>
        <div class='form-group' id="ev11">
          {{form.excremento_ave.label}}
          {{form.excremento_ave}}
        </div>
        <div class='form-group' id="ev12">
          {{form.estadio_2.label}}
          {{form.estadio_2}}
        </div>
        <div class='form-group' id="ev8">
          {{form.optimo.label}}
          {{form.optimo}}
        </div>
				
	    <div class='form-group' id="ev9">
          {{form.fruta_suelo.label}}
          {{form.fruta_suelo}}
        </div>
		
          <div class='form-group' id="ev10">
          {{form.exportable.label}}
          {{form.exportable}}
        </div>
        

        <div class='form-group'>
          {{form.longitud.label}}
          {{form.longitud}}
        </div>
         <div class='form-group'>
          {{form.latitud.label}}
          {{form.latitud}}
        </div>

				<input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
			</form>
	</div>
	</div>
</div>
</div>
</div>
</section>
{% endblock %}
{%block script%}
<script type="text/javascript">
  
  $("#id_anexo_tipo").change(function(){
        var item=$(this).val();
        if (item==1)
        {
            $("#ev2").css("display", "none");
            $("#ev8").css("display", "none");
            $("#ev9").css("display", "none");
            $("#ev10").css("display", "none");
            
        }   
        else
        {
             if (item==3)
            {
                $("#ev1").css("display", "none");
                $("#ev3").css("display", "none");
                $("#ev5").css("display", "none");
                $("#ev6").css("display", "none");
                $("#ev7").css("display", "none");
                $("#ev10").css("display", "none");
                $("#ev11").css("display", "none");
                $("#ev12").css("display", "none");
            }  

            if (item==2)
            {
                $("#ev2").css("display", "none");
                $("#ev3").css("display", "none");
                $("#ev4").css("display", "none");
                $("#ev5").css("display", "none");
                $("#ev6").css("display", "none");
                $("#ev7").css("display", "none");
                $("#ev8").css("display", "none");
                $("#ev9").css("display", "none");
                $("#ev11").css("display", "none");
                $("#ev12").css("display", "none");
            }      
        } 
   })

</script>


 <script>  
  $(function () {  
   $("#id_fecha").datetimepicker({  
       format: 'd/m/Y',  
       timepicker:false  
   });  
  });  
 </script>
 <script>  
     $(document).ready(function () {  
           jQuery.datetimepicker.setLocale('es');  
           $('#id_anexo_caseta').val(2);
     });  
   </script> 

   
    <script>  
     $(document).ready(function () {  
		n =  new Date();
		y = n.getFullYear();
		//Mes
		m = n.getMonth() + 1;
		//DÃ­a
		d = n.getDate();

//Lo ordenas a gusto.
		if(m<10)
    {
      if(d<10)
      {
        $("#id_fecha").val("0"+ d + "/" +"0" +m + "/" +y);
      }
      else
      {
        $("#id_fecha").val( d + "/" +"0" +m + "/" +y);  
      }
    }
    else
    {
       if(d<10)
      {
        $("#id_fecha").val("0"+ d + "/" + m + "/" +y);
      }
      else
      {
        $("#id_fecha").val( d + "/" + m + "/" +y);  
      }
    }


          


          

     });  
   </script>


<script type="text/javascript">
     
      
    
      $('#id_anexo_responsable').select2();
       $('#id_anexo_produccion').select2();
      
      $("#id_anexo_cultivo option[value="+ 2 +"]").attr("selected",true);      
  
     // $("#id_anexo_cultivo").val(2).trigger('change');
      //$("#id_anexo_eje").val(2).trigger('change');
     
      
 function request_zona (fundoId) {
		var urldata="/ajax/load-fundos/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;
        		
        } 
        $("#id_anexo_fundo").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
   
 function request_pep (ubicacionId) {
		var urldata="/ajax/load-pep/" + ubicacionId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].anexo_fundo__abreviatura} ${data[i].anexo_modulo__nombremodulo} ${data[i].anexo_lote__nom_lote}</option>`;
        		
        } 
        $("#id_ubicacion").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 





       $("#id_anexo_zona").change(function () { 

      var fundoId = $(this).val();
      	
      request_zona(fundoId)
    });

  $("#id_anexo_fundo").change(function () { 

      var ubicacionId = $(this).val();
      	
      request_pep(ubicacionId)
    });



  </script>


<script type="text/javascript">
     
  
   if ("geolocation" in navigator)
          { //check geolocation available 
    //try to get user current location using getCurrentPosition() method
         navigator.geolocation.getCurrentPosition(function(position){ 
             console.log("Found your location nLat : "+position.coords.latitude+" nLang :"+ position.coords.longitude);
             lat=position.coords.latitude;
             lon=position.coords.longitude;

             nlat=Math.round((lat)*10000000)/10000000;
             nlon=Math.round((lon)*10000000)/10000000;
             $("#id_longitud").val(nlon);
       $("#id_latitud").val(nlat);
           });

      }
    else
    {
         console.log("Browser doesn't support geolocation!");
    }

  </script>



{% endblock %}