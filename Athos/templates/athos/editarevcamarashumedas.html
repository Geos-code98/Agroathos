{% extends 'base/baseathos.html' %}
{% block contenido%}

<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
          <div class="col-lg-6">
           <div class="card">
               <div class="card-header"><strong>Registro</strong><small> EV. CÁMARAS HÚMEDAS</small></div>
               <div class="card-body card-block">
                 <form id="frmajax"  method="post" data-validate="parsley">
                    {% csrf_token %}
                    {% if form.errors %}
                    {% for field in form %}
                    {% for error in field.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ field.label|escape }}:</strong>
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                    <div class="alert alert-danger">
                        <strong>{{ error|escape }}</strong>
                    </div>
                    {% endfor %}
                    {% endif %}

                    <div class='form-group'>
                        {{form.anexo_tipo_evaluacion.label}}
                        {{form.anexo_tipo_evaluacion}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_zona.label}}
                        {{form.anexo_zona}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_fundo.label}}
                        {{form.anexo_fundo}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_pep.label}}
                        {{form.anexo_pep}}
                    </div>
                    <div class='form-group'>
                        {{form.sub_lote.label}}
                        {{form.sub_lote}}
                    </div>
                    <div class='form-group'>
                        {{form.fecha_instalacion.label}}
                        {{form.fecha_instalacion}}
                    </div>
                    <div class='form-group'>
                        {{form.muestra.label}}
                        {{form.muestra}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_variedad.label}}
                        {{form.anexo_variedad}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_condicion.label}}
                        {{form.anexo_condicion}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_organo.label}}
                        {{form.anexo_organo}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_ubicacion.label}}
                        {{form.anexo_ubicacion}}
                    </div>
                    <div class='form-group'>
                        {{form.anexo_producto2.label}}
                        {{form.anexo_producto2}}
                    </div>
                    <div class='form-group'>
                        {{form.dias_aplicacion.label}}
                        {{form.dias_aplicacion}}
                    </div>

                    <input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
                </form>
            </div>
        </div>
    </div>
</div>
</div>
</section>
{% endblock %}
{%block script%}
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.1/select2.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.1/select2.min.js"></script>
<script>  
  $(function () {
    $("#id_fecha_instalacion").datetimepicker({  
         format: 'd/m/Y',  
         timepicker:false  
     });
    
     $('#id_anexo_zona').select2();
     $('#id_anexo_fundo').select2();
     $('#id_anexo_pep').select2();
     $('#id_anexo_producto2').select2();

     $("#id_anexo_pep").on('select2-opening',function(){
        var ubicacionId = $("#id_anexo_fundo").val();
        request_pep(ubicacionId)
    });
 });  
</script>

<script>  
   $(document).ready(function () {  
     jQuery.datetimepicker.setLocale('es');  
 });
</script> 

<script type="text/javascript">
    $("#id_anexo_zona").change(function () { 
        var zonaId = $(this).val();
        if (zonaId == "") {
            var zonaId = $("#id_anexo_zona").val();
            request_zona(zonaId)
        }else{
            request_zona(zonaId)
        }
    });
    $("#id_anexo_fundo").change(function () { 
        var ubicacionId = $(this).val();
        if (ubicacionId == "") {
            var ubicacionId = $("#id_anexo_fundo").val();
            request_pep(ubicacionId)
        }else{
            request_pep(ubicacionId)
        }
    });

    function request_zona (fundoId) {
        var urldata="/ajax/load-fundos/" + fundoId;

        $.ajax({                       
            url: urldata,                    
            data: {},
            success: function (data) {
                var option_html = `<option value="0" >---------</option>`;
                for (var i = 0; i < data.length; i++) {     
                    option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;
                } 
                $("#id_anexo_fundo").html(option_html);
                console.log(option_html);
            },
            error: function(result) {
                console.log(result);
            }

        });

    } 

    function request_pep (ubicacionId) {
        var urldata="/ajax/load-pep/" + ubicacionId;

        $.ajax({                       
            url: urldata,                    
            data: {},
            success: function (data) {
                var option_html = `<option value="0" >---------</option>`;
                for (var i = 0; i < data.length; i++) {     
                    option_html += `<option value="${data[i].id}" >${data[i].anexo_fundo__abreviatura} ${data[i].anexo_modulo__nombremodulo} ${data[i].anexo_lote__nom_lote} ${data[i].ano_campana}</option>`;
                } 
                $("#id_anexo_pep").html(option_html);
                console.log(option_html);
            },
            error: function(result) {
                console.log(result);
            }

        });

    } 
</script>
{% endblock %}