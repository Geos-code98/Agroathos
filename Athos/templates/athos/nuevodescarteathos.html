{% extends 'base/baseathos.html' %}
{% block contenido%}



<section class="contenedor" id="section-usuarios">
	<div id="registration-form">
		<div class='fieldset'>
		<div class="col-lg-6">
					<div class="card">
					<div class="card-header"><strong>Registro</strong><small> DESCARTE ATHOS</small></div>
					<div class="card-body card-block">
			<form id="frmajax"  method="post" data-validate="parsley">
				{% csrf_token %}
				{% if form.errors %}
            {% for field in form %}

                {% for error in field.errors %}
                    <div class="alert alert-danger">
                        <strong>{{ field.label|escape }}:</strong>
                        <strong>{{ error|escape }}</strong>
                    </div>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <div class="alert alert-danger">
                    <strong>{{ error|escape }}</strong>
                </div>
            {% endfor %}
        {% endif %}

				<div class='form-group'>
					{{form.anexo_eje.label}}
					{{form.anexo_eje}}
				</div>
        <div class='form-group'>
          {{form.anexo_fundo.label}}
          {{form.anexo_fundo}}
        </div>
				<div class='form-group'>
					{{form.anexo_planta.label}}
					{{form.anexo_planta}}
				</div>
				<div class='form-group'>
					{{form.anexo_nave.label}}
					{{form.anexo_nave}}
				</div>
				<div class='form-group'>
					{{form.anexo_material.label}}
					{{form.anexo_material}}
				</div>
        <div class='form-group'>
          {{form.anexo_turno.label}}
          {{form.anexo_turno}}
        </div>
				<div class='form-group'>
					{{form.fecha_lanzado.label}}
					{{form.fecha_lanzado}}
				</div>
          <div class='form-group'>
          {{form.cant_jabas.label}}
          {{form.cant_jabas}}
        </div>
          <div class='form-group'>
          {{form.peso_bruto.label}}
          {{form.peso_bruto}}
        </div>
				<div class='form-group'>
					{{form.peso_descarte.label}}
					{{form.peso_descarte}}
				</div>
        <div class='form-group'>
          {{form.merma_maquina.label}}
          {{form.merma_maquina}}
        </div>
        <div class='form-group'>
          {{form.merma_proceso.label}}
          {{form.merma_proceso}}
        </div>
				
				<div class='form-group'>
          {{form.merma_recepcion.label}}
          {{form.merma_recepcion}}
        </div>
				
				<div class='form-group'>
          {{form.descarte_mini.label}}
          {{form.descarte_mini}}
        </div>
        <div class='form-group'>
          {{form.recuperable.label}}
          {{form.recuperable}}
        </div>
         <div class='form-group'>
          {{form.norecuperable.label}}
          {{form.norecuperable}}
        </div>

				<input type="submit" value="Registrar" id="registrar" class="btn btn-primary">
			</form>
	</div>
	</div>
</div>
</div>
</div>
</section>
{% endblock %}

{%block script%}
<script type="text/javascript">
     
        $('#id_anexo_material').select2();
        
      
     // $("#id_anexo_cultivo").val(2).trigger('change');
      //$("#id_anexo_eje").val(2).trigger('change');
  $('#id_peso_bruto').change(function(){
       
      
    var neto=0;
    var jabas=parseFloat( $("#id_cant_jabas").val());
    var bruto=parseFloat( $("#id_peso_bruto").val());

   

    neto=Math.round((bruto-jabas*1.7)*100)/100;
   
    $('#id_peso_descarte').val(neto);
  
    
      
    
    //alert(java);
       //document.getElementById(canjavas).value = java;
      // $("#id_npalet").val(arreglo[0]);
      // $("#id_njavas").val(arreglo[7]);
       //$("#id_peso").val(arreglo[6].replace(",","."));
       
      

       


        return false;
    });




     

function request_zona (fundoId) {
    var urldata="/ajax/load-fundos/" + fundoId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) {   
        
            
              option_html += `<option value="${data[i].id}" >${data[i].nom_fundo}</option>`;
            
        } 
        $("#id_anexo_fundo").html(option_html);
          console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

  }   



 function request_planta (plantaId) {
		var urldata="/ajax/load-planta/" + plantaId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].nom_planta}</option>`;
        		
        } 
        $("#id_anexo_planta").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 
   
 function request_nave (naveId) {
		var urldata="/ajax/load-nave/" + naveId;
     
      $.ajax({                       
        url: urldata,                    
        data: {},
        success: function (data) {
        var option_html = `<option value="0" >---------</option>`;
        for (var i = 0; i < data.length; i++) { 	
        
        		
        			option_html += `<option value="${data[i].id}" >${data[i].nom_nave}</option>`;
        		
        } 
        $("#id_anexo_nave").html(option_html);
        	console.log(option_html);
        },
        error: function(result) {
            console.log(result);
        }

      });

	} 





       $("#id_anexo_eje").change(function () { 

      var plantaId = $(this).val();
      	
      request_planta(plantaId)
    });

          $("#id_anexo_eje").change(function () { 

      var fundoId = $(this).val();
        
      request_zona(fundoId)
    });

  $("#id_anexo_planta").change(function () { 

      var naveId = $(this).val();
      	
      request_nave(naveId)
    });

    
  </script>

 <script>  
  $(function () {  
   $("#id_fecha_lanzado").datetimepicker({  
       format: 'd/m/Y',  
       timepicker:false  
   });  
  });  
 </script>
 <script>  
     $(document).ready(function () {  
           jQuery.datetimepicker.setLocale('es');  
     });  
   </script> 

   
    <script>  
     $(document).ready(function () {  
		n =  new Date();
		y = n.getFullYear();
		//Mes
		m = n.getMonth() + 1;
		//DÃ­a
		d = n.getDate();

//Lo ordenas a gusto.
		 
          if(d<10)
		 {
          $("#id_fecha_lanzado").val("0"+ d + "/" +"0" +m + "/" +y);
      	 }
      	 else
      	 {
      	 	 $("#id_fecha_lanzado").val( d + "/" +"0" +m + "/" +y);	
      	 }


          

     });  
   </script>


{% endblock %}